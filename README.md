# Система детекции средств индивидуальной защиты (СИЗ)

Проект для обучения модели YOLOv8 на детекцию средств индивидуальной защиты: каски, жилеты и перчатки.

## Подготовка данных для обучения

### 1. Какие данные нужно разметить

Для обучения модели необходимо собрать и разметить изображения, содержащие следующие объекты:

#### Классы для разметки:

1. **Каска (helmet)** - класс 0
   - Разные типы защитных касок
   - Разные углы обзора (спереди, сбоку, сверху)
   - Разные условия освещения
   - Каски разных цветов

2. **Жилет (vest)** - класс 1
   - Светоотражающие жилеты
   - Обычные защитные жилеты
   - Разные позы людей (стоя, сидя, в движении)
   - Частично видимые жилеты

3. **Перчатки (gloves)** - класс 2
   - Разные типы рабочих перчаток
   - Перчатки на руках людей
   - Разные углы обзора
   - Перчатки разных цветов

#### Рекомендации по сбору данных:

- **Минимум 100-200 изображений на класс** для базового обучения
- **Желательно 500+ изображений на класс** для качественной модели
- Разнообразие условий:
  - Разное освещение (дневное, искусственное, темное)
  - Разные ракурсы и углы обзора
  - Разные расстояния до объектов
  - Разные фоны (производство, стройка, офис)
  - Разные погодные условия (если съемка на улице)
- Изображения должны быть в формате **JPG** или **PNG**
- Рекомендуемое разрешение: **640x640** или выше (модель автоматически изменит размер)

### 2. Как размечать данные

#### Формат разметки YOLO

Каждое изображение должно иметь соответствующий текстовый файл с разметкой в формате YOLO.

**Формат файла разметки (.txt):**
```
class_id center_x center_y width height
```

Где:
- `class_id` - номер класса (0 для каски, 1 для жилета, 2 для перчаток)
- `center_x` - координата X центра объекта (нормализованная от 0 до 1)
- `center_y` - координата Y центра объекта (нормализованная от 0 до 1)
- `width` - ширина bounding box (нормализованная от 0 до 1)
- `height` - высота bounding box (нормализованная от 0 до 1)

**Пример файла разметки (image001.txt):**
```
0 0.5 0.3 0.2 0.25
1 0.7 0.6 0.15 0.2
2 0.3 0.8 0.1 0.15
```

Это означает:
- Каска в центре изображения
- Жилет справа внизу
- Перчатки слева внизу

#### Инструменты для разметки

Рекомендуемые инструменты:

1. **LabelImg** (самый популярный)
   - Скачать: https://github.com/HumanSignal/labelImg
   - Установка: `pip install labelImg`
   - Запуск: `labelImg`
   - Важно: при сохранении выбрать формат **YOLO** (не PascalVOC!)

2. **Roboflow** (онлайн)
   - https://roboflow.com/
   - Бесплатный аккаунт, удобный интерфейс

3. **CVAT** (Computer Vision Annotation Tool)
   - https://github.com/openvinotoolkit/cvat
   - Для больших команд

#### Процесс разметки:

1. Откройте изображение в инструменте разметки
2. Для каждого объекта на изображении:
   - Выберите соответствующий класс (helmet/vest/gloves)
   - Нарисуйте bounding box вокруг объекта
   - Убедитесь, что box плотно обхватывает объект, но не слишком близко
3. Сохраните разметку в формате YOLO
4. Файл разметки должен иметь **то же имя**, что и изображение, но с расширением `.txt`

**Пример:**
- Изображение: `image001.jpg`
- Разметка: `image001.txt`

### 3. Структура директорий

Поместите все разметенные изображения и файлы разметки в следующие директории:

```
data/
├── images/
│   ├── train/          # Все изображения для обучения (80-90%)
│   └── val/            # Изображения для валидации (10-20%)
└── labels/
    ├── train/          # Файлы разметки для обучения (.txt)
    └── val/            # Файлы разметки для валидации (.txt)
```

**Важно:**
- Имена файлов изображений и разметки должны совпадать (кроме расширения)
- Например: `image001.jpg` и `image001.txt`
- Файлы разметки должны быть в формате YOLO

### 4. Разделение на train/val

После разметки всех изображений разделите их на обучающую и валидационную выборки:

**Вариант 1: Автоматическое разделение**

Поместите все изображения и разметку в `data/images/train/` и `data/labels/train/`, затем запустите:

```bash
python split_dataset.py --ratio 0.2
```

Это автоматически переместит 20% данных в валидационную выборку.

**Вариант 2: Ручное разделение**

1. Соберите все изображения и разметку
2. Вручную разделите на train (80-90%) и val (10-20%)
3. Поместите в соответствующие директории

**Рекомендации:**
- Используйте соотношение 80/20 или 90/10
- Убедитесь, что в train и val есть примеры всех классов
- Старайтесь сохранить разнообразие в обеих выборках

### 5. Проверка данных перед обучением

Перед запуском обучения убедитесь:

1. ✅ Все изображения имеют соответствующие файлы разметки
2. ✅ Имена файлов совпадают (кроме расширения)
3. ✅ Формат разметки YOLO корректен
4. ✅ В train и val есть примеры всех 3 классов
5. ✅ Конфигурационный файл `config/ppe_data.yaml` настроен правильно

### 6. Запуск обучения

После подготовки данных запустите обучение:

```bash
python train.py
```

Модель будет обучена и сохранена в `models/ppe_model/weights/best.pt`

## Требования

- Python 3.8+
- ultralytics (YOLOv8)
- opencv-python
- numpy

Установка зависимостей:
```bash
pip install -r requirements.txt
```

## Использование обученной модели

После обучения модель можно использовать для детекции:

```bash
# Детекция на видео
python detect_video.py --video input.mp4 --model models/ppe_model/weights/best.pt

# Детекция с камеры
python detect_camera.py --model models/ppe_model/weights/best.pt
```

